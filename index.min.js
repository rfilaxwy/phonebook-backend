const express=require("express"),app=express(),morgan=require("morgan"),cors=require("cors");app.use(express.static("build")),app.use(cors()),app.use(express.json()),morgan.token("body",(function(req,res){return JSON.stringify(req.body)})),app.use(morgan(":method :url :status :response-time ms - :res[content-length] :body - :req[content-length]"));let persons=[{name:"Bing Crosby",number:"004-123456",id:1},{name:"HP Lovecraft",number:"004-123456",id:2},{name:"Stephen King",number:"004-123456",id:3},{name:"Bon Iver",number:"004-123456",id:4}];app.get("/api/persons",(req,res)=>{res.json(persons)}),app.get("/info",(req,res)=>{res.status(200).send(`\n        <p>Phonebook has info for ${persons.length} people</p>\n        <p>${new Date}</p>\n    `)}),app.get("/api/persons/:id",(req,res)=>{const id=parseInt(req.params.id);if(id){const person=persons.filter(person=>person.id===id);person.length>0?res.json(person):res.status(404).end()}}),app.delete("/api/persons/:id",(req,res)=>{const id=parseInt(req.params.id);persons.filter(person=>person.id!=id),res.status(204).end()});const generateId=()=>{let id,repeatId;do{id=Math.floor(2e4*Math.random()),repeatId=persons.some(person=>person.id==id)}while(repeatId);return id};app.post("/api/persons",(req,res)=>{const body=req.body;if(!body.name||!body.number)return res.status(400).json({error:"content missing"});let repeatName;if(persons.some(person=>person.name==body.name))return res.status(409).json({error:"Name already exists"});const newPerson={name:body.name,number:body.number,id:generateId()};persons=persons.concat(newPerson),res.json(persons)});const PORT=process.env.PORT||3001;app.listen(PORT,console.log(`Listenting on port ${PORT}`));